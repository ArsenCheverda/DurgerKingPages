<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no, user-scalable=no">
  <title>Durger King - Mini App</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    .page {
      display: none;
      flex-direction: column;
      min-height: 100vh;
      padding: 15px;
      box-sizing: border-box;
    }
    .page.active { display: flex; }

    /* –°—ñ—Ç–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤ (–±–µ–∑ –∑–º—ñ–Ω) */
    #catalog-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      width: 100%;
    }

    .product-card {
      background-color: var(--tg-theme-secondary-bg-color, #f2f2f2);
      border-radius: 12px;
      padding: 8px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      width: 105px; /* 3 –∫–æ–ª–æ–Ω–∫–∏ */
    }

    /* –ú—ñ—Å—Ü–µ –ø—ñ–¥ –∞–Ω—ñ–º–æ–≤–∞–Ω–∏–π –µ–º–æ–¥–∑—ñ */
    .emoji-box {
      width: 70px;
      height: 70px;
      margin: 0 auto 5px auto;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
    }
    .emoji-box video,
    .emoji-box img {
      width: 70px;
      height: 70px;
      object-fit: contain;
      display: block;
    }

    /* –°–∫–µ–ª–µ—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è */
    #skeleton-loader {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      width: 100%;
    }
    .skeleton-card {
      width: 105px;
      height: 180px;
      border-radius: 12px;
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s infinite linear;
    }
    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .item-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: #e74c3c;
      color: white;
      font-size: 0.8rem;
      font-weight: bold;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid var(--tg-theme-bg-color, #fff);
    }

    .new-badge {
      background-color: #27ae60;
      color: white;
      font-size: 0.6rem;
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 6px;
      text-transform: uppercase;
    }

    .shimmer-btn {
      position: relative;
      overflow: hidden;
      background-color: var(--tg-theme-button-color, #3390ec);
      color: var(--tg-theme-button-text-color, #ffffff);
    }
    .shimmer-btn::after {
      content: '';
      position: absolute;
      top: 0;
      left: -150%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
      transform: skewX(-25deg);
      animation: shimmer 5s infinite;
    }
    @keyframes shimmer {
      0% { left: -150%; }
      40% { left: 150%; }
      100% { left: 150%; }
    }

    /* –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∑–∞ –∑—ñ—Ä–æ—á–∫–∏ */
    #star-modal {
      position: fixed;
      inset: 0;
      background-color: rgba(0,0,0,0.5);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      z-index: 100;
    }
    #star-modal.visible { opacity: 1; visibility: visible; }
    .modal-content {
      background-color: var(--tg-theme-secondary-bg-color, #fff);
      width: 100%;
      padding: 20px;
      border-radius: 20px 20px 0 0;
      text-align: center;
      transform: translateY(100%);
      transition: transform 0.3s ease;
    }
    #star-modal.visible .modal-content { transform: translateY(0); }

    /* –í–µ–ª–∏–∫–∏–π –µ–º–æ–¥–∑—ñ –≤ –º–æ–¥–∞–ª—Ü—ñ */
    #modal-emoji {
      width: 120px;
      height: 120px;
      margin: 0 auto;
      display: block;
      object-fit: contain;
    }
  </style>
</head>
<body>

  <!-- –°—Ç–æ—Ä—ñ–Ω–∫–∞ 1: –ö–∞—Ç–∞–ª–æ–≥ -->
  <div id="catalog-page" class="page active">
    <div id="skeleton-loader"></div>
    <div id="catalog-grid" style="display: none;"></div>
  </div>

  <!-- –°—Ç–æ—Ä—ñ–Ω–∫–∞ 2: –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è -->
  <div id="order-page" class="page">
    <div class="w-full">
      <h2 class="text-xl font-bold mb-4">YOUR ORDER</h2>
      <div id="order-list" class="space-y-4"></div>
      <div class="mt-6 border-t pt-4">
        <div class="flex justify-between font-bold text-lg">
          <span>Total</span>
          <span id="order-total-price">$0.00</span>
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∑–∞ –∑—ñ—Ä–æ—á–∫–∏ -->
  <div id="star-modal">
    <div class="modal-content">
      <div class="flex justify-end mb-2">
        <button onclick="closeStarModal()" class="text-gray-400 text-2xl">&times;</button>
      </div>
      <!-- –¢–£–¢ –ë–£–î–ï –ê–ù–Ü–ú. –ï–ú–û–î–ó–Ü -->
      <video id="modal-emoji" muted playsinline></video>
      <h2 id="modal-product-name" class="text-2xl font-bold mt-2">Cake</h2>
      <p class="text-gray-500 mb-4">Durger King</p>
      <p class="mb-6">Do you want to buy Cake in Durger King for 1 star?</p>
      <button id="confirm-star-payment" class="w-full py-3 rounded-lg font-semibold shimmer-btn">
        Confirm and Pay ‚òÖ 1 Star
      </button>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;

    /*** =======================
     *  –ù–ê–°–¢–†–û–ô–ö–ò / –ü–†–û–ö–°–ò
     * ======================== */
    // –£–∫–∞–∂–∏—Ç–µ –≤–∞—à –±–µ–∫–µ–Ω–¥-—Ä–æ—É—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–µ—Ä–Ω—ë—Ç JSON –≤–∏–¥–∞:
    // { ok: true, emoji: "üçî", webm: "https://.../file.webm", webp: "https://.../file.webp", width: 512, height: 512 }
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏ ‚Äî –≤–Ω–∏–∑—É —Ñ–∞–π–ª–∞ –≤ –≤–∏–¥–µ –ø—Ä–∏–º–µ—Ä–∞ –Ω–∞ Node/Express.
    const STICKER_PROXY_URL = '/api/animated-emoji';

    // –ö—ç—à: emoji -> {webm, webp, width, height}
    const animatedEmojiCache = new Map();

    // –ü–æ–ª—É—á–∏—Ç—å URL—ã –º–µ–¥–∏–∞ –¥–ª—è —ç–º–æ–¥–∑–∏ (webm –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ)
    async function getAnimatedEmojiMedia(emoji) {
      if (animatedEmojiCache.has(emoji)) return animatedEmojiCache.get(emoji);

      try {
        const url = `${STICKER_PROXY_URL}?emoji=${encodeURIComponent(emoji)}`;
        const res = await fetch(url, { method: 'GET' });
        if (!res.ok) throw new Error('Proxy HTTP error');
        const data = await res.json();
        if (data && data.ok && (data.webm || data.webp)) {
          animatedEmojiCache.set(emoji, data);
          return data;
        }
      } catch (e) {
        // –º–æ–ª—á–∞ –ø–∞–¥–∞–µ–º –≤ graceful fallback (—Å—Ç–∞—Ç–∏—á–Ω–∏–π –µ–º–æ–¥–∑—ñ)
      }
      animatedEmojiCache.set(emoji, null);
      return null;
    }

    // –í—Å—Ç–∞–≤–∫–∞ ‚Äú—Å—Ç—ñ–∫–µ—Ä-—è–∫-–∫–∞—Ä—Ç–∏–Ω–∫–∞‚Äù: video webm (loop one-time), tap to replay.
    async function mountAnimatedEmoji(containerEl, emoji, size = 70) {
      containerEl.innerHTML = '';
      containerEl.style.width = `${size}px`;
      containerEl.style.height = `${size}px`;

      const media = await getAnimatedEmojiMedia(emoji);

      if (media && media.webm) {
        const v = document.createElement('video');
        v.src = media.webm;
        v.width = size;
        v.height = size;
        v.muted = true;
        v.playsInline = true;
        v.autoplay = true;     // –∞–≤—Ç–æ—Å—Ç–∞—Ä—Ç
        v.loop = false;        // –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ ‚Äî –Ω–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ–º
        v.preload = 'metadata';
        v.style.objectFit = 'contain';
        v.addEventListener('ended', () => {
          // –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ—Å—Ç–∞–≤–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–∞–¥—Ä –∫–∞–∫ –ø–æ—Å—Ç–µ—Ä (–±—Ä–∞—É–∑–µ—Ä —Ç–∞–∫ –∏ –¥–µ–ª–∞–µ—Ç)
        });
        v.addEventListener('click', () => {
          v.currentTime = 0;
          v.play();
        });
        containerEl.appendChild(v);
        return v;
      }

      if (media && media.webp) {
        // –§–æ–ª–±–µ–∫: —Å—Ç–∞—Ç–∏—á–Ω–∏–π webp –ø—Ä–µ–≤—å—é –∑ –ø—Ä–æ–∫—Å—ñ
        const img = document.createElement('img');
        img.src = media.webp;
        img.width = size;
        img.height = size;
        img.alt = emoji;
        img.draggable = false;
        containerEl.appendChild(img);
        return img;
      }

      // Ultimate fallback: –ø—Ä–æ—Å—Ç–æ —Å–∏–º–≤–æ–ª –µ–º–æ–¥–∑—ñ
      const span = document.createElement('span');
      span.textContent = emoji;
      span.style.fontSize = Math.floor(size * 0.8) + 'px';
      containerEl.appendChild(span);
      return span;
    }

    /*** =======================
     *  –î–ê–ù–Ü –¢–û–í–ê–†–Ü–í
     * ======================== */
    const products = [
      { id: 1,  name: 'Cake',     price: 1.00, emoji: 'üç∞', isNew: true,  isStar: true },
      { id: 2,  name: 'Burger',   price: 4.99, emoji: 'üçî' },
      { id: 3,  name: 'Fries',    price: 1.49, emoji: 'üçü' },
      { id: 4,  name: 'Hotdog',   price: 3.49, emoji: 'üå≠' },
      { id: 5,  name: 'Taco',     price: 3.99, emoji: 'üåÆ' },
      { id: 6,  name: 'Pizza',    price: 7.99, emoji: 'üçï' },
      { id: 7,  name: 'Donut',    price: 1.49, emoji: 'üç©' },
      { id: 8,  name: 'Popcorn',  price: 1.99, emoji: 'üçø' },
      { id: 9,  name: 'Coke',     price: 1.49, emoji: 'ü•§' },
      { id: 10, name: 'Icecream', price: 5.99, emoji: 'üç¶' },
      { id: 11, name: 'Cookie',   price: 3.99, emoji: 'üç™' },
      { id: 12, name: 'Flan',     price: 7.99, emoji: 'üçÆ' },
    ];

    /*** =======================
     *  –°–¢–ê–ù
     * ======================== */
    let cart = {};
    let currentPage = 'catalog-page';

    /*** =======================
     *  DOM
     * ======================== */
    const pages = document.querySelectorAll('.page');
    const skeletonLoader = document.getElementById('skeleton-loader');
    const catalogGrid = document.getElementById('catalog-grid');
    const orderList = document.getElementById('order-list');
    const orderTotalPrice = document.getElementById('order-total-price');
    const starModal = document.getElementById('star-modal');
    const modalProductName = document.getElementById('modal-product-name');
    const confirmStarPaymentBtn = document.getElementById('confirm-star-payment');
    const modalEmojiVideo = document.getElementById('modal-emoji');

    /*** =======================
     *  –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø
     * ======================== */
    function renderSkeleton() {
      let skeletonHtml = '';
      for (let i = 0; i < 12; i++) {
        skeletonHtml += '<div class="skeleton-card"></div>';
      }
      skeletonLoader.innerHTML = skeletonHtml;
    }

    function productControlsHtml(product, quantity) {
      if (product.isStar) {
        return `<button class="w-full mt-2 h-9 rounded-lg text-sm font-bold shimmer-btn" style="background-color: #27ae60;" onclick="buyWithStars(${product.id})">BUY</button>`;
      }
      return `
        <div class="w-full mt-2 h-9 relative">
          <button class="absolute left-0 top-0 h-full w-[48%] rounded-lg text-white text-xl font-bold transition-all duration-300 ease-in-out ${quantity > 0 ? 'opacity-100 translate-x-0' : 'opacity-0 -translate-x-4 pointer-events-none'}" style="background-color: #e74c3c;" onclick="removeFromCart(${product.id})">-</button>
          <div class="absolute right-0 top-0 h-full rounded-lg text-white font-bold transition-all duration-300 ease-in-out ${quantity > 0 ? 'w-[48%]' : 'w-full'}" style="background-color: #f39c12;">
            <span class="absolute inset-0 flex items-center justify-center text-sm transition-opacity duration-150 ${quantity > 0 ? 'opacity-0 pointer-events-none' : 'opacity-100'}" onclick="addToCart(${product.id})">ADD</span>
            <span class="absolute inset-0 flex items-center justify-center text-xl transition-opacity duration-150 ${quantity > 0 ? 'opacity-100' : 'opacity-0 pointer-events-none'}" onclick="addToCart(${product.id})">+</span>
          </div>
        </div>`;
    }

    async function renderCatalog() {
      catalogGrid.innerHTML = '';
      for (const product of products) {
        const quantity = cart[product.id] || 0;

        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          <div class="relative w-full">
            <div class="emoji-box" data-emoji="${product.emoji}" aria-label="${product.name}"></div>
            ${quantity > 0 ? `<div class="item-badge">${quantity}</div>` : ''}
          </div>
          <div>
            <div class="font-semibold text-xs flex items-center justify-center space-x-1 h-8">
              <span>${product.name}</span>
              ${product.isNew ? `<span class="new-badge">NEW</span>` : ''}
              ${product.isStar ? `<span class="text-yellow-400 text-xs">‚òÖ</span>` : ''}
            </div>
            <p class="text-gray-500 text-sm font-bold mb-1">
              ${product.isStar ? `${product.price} ‚òÖ` : `$${product.price.toFixed(2)}`}
            </p>
          </div>
          ${productControlsHtml(product, quantity)}
        `;
        catalogGrid.appendChild(card);

        // —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –µ–º–æ–¥–∑—ñ (loop once)
        const box = card.querySelector('.emoji-box');
        const node = await mountAnimatedEmoji(box, product.emoji, 70);
        // –ù–µ–±–æ–ª—å—à–æ–π –∞–≤—Ç–æ–ø–ª–µ–π (1 —Ä–∞–∑): –µ—Å–ª–∏ —ç—Ç–æ –≤–∏–¥–µ–æ, –¥–æ–∂–º–µ–º play()
        if (node && node.tagName === 'VIDEO') {
          try { node.play().catch(()=>{}); } catch(e){}
        }
      }
      updateMainButton();
    }

    function renderOrder() {
      let orderHtml = '';
      const total = calculateTotal();
      if (total.items === 0) {
        orderHtml = '<p class="text-center text-gray-500">Your order is empty.</p>';
      } else {
        const blocks = [];
        for (const productId in cart) {
          const product = products.find(p => p.id == productId);
          if (!product) continue;
          const quantity = cart[productId];
          const itemTotal = product.price * quantity;
          const id = `order-emoji-${product.id}-${Date.now()}`;
          blocks.push(`
            <div class="flex items-center">
              <div class="emoji-box" id="${id}" style="width:50px;height:50px;margin-right:15px;"></div>
              <div class="flex-grow">
                <p class="font-bold">${product.name} <span class="text-gray-500 font-normal">x${quantity}</span></p>
              </div>
              <div class="font-semibold">$${itemTotal.toFixed(2)}</div>
            </div>
          `);
        }
        orderHtml = blocks.join('');
      }
      orderList.innerHTML = orderHtml;

      // –°–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–º–æ–¥–∑–∏ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤
      for (const productId in cart) {
        const product = products.find(p => p.id == productId);
        if (!product) continue;
        const el = document.getElementById(`order-emoji-${product.id}-${Object.keys(cart).length === 1 ? '0' : ''}`) || document.querySelector(`#order-list .emoji-box[id^="order-emoji-${product.id}-"]`);
        if (el) mountAnimatedEmoji(el, product.emoji, 50);
      }

      orderTotalPrice.textContent = `$${total.price.toFixed(2)}`;
    }

    function showPage(pageId) {
      currentPage = pageId;
      pages.forEach(page => page.classList.toggle('active', page.id === pageId));

      if (pageId === 'catalog-page') {
        tg.BackButton.hide();
        updateMainButton();
      } else if (pageId === 'order-page') {
        renderOrder();
        tg.BackButton.show();
        const total = calculateTotal();
        tg.MainButton.setText(`Pay $${total.price.toFixed(2)}`);
        tg.MainButton.show();
      }
    }

    /*** =======================
     *  –õ–û–ì–Ü–ö–ê
     * ======================== */
    function addToCart(productId) {
      cart[productId] = (cart[productId] || 0) + 1;
      renderCatalog();
    }
    function removeFromCart(productId) {
      if (cart[productId] > 1) cart[productId]--;
      else delete cart[productId];
      renderCatalog();
    }

    function calculateTotal() {
      let total = { price: 0, items: 0 };
      for (const productId in cart) {
        const product = products.find(p => p.id == productId && !p.isStar);
        if (product) {
          const quantity = cart[productId];
          total.price += product.price * quantity;
          total.items += quantity;
        }
      }
      return total;
    }

    function updateMainButton() {
      const total = calculateTotal();
      if (total.items > 0) {
        tg.MainButton.setText(`View Order ($${total.price.toFixed(2)})`);
        tg.MainButton.show();
      } else {
        tg.MainButton.hide();
      }
    }

    async function buyWithStars(productId) {
      const product = products.find(p => p.id == productId);
      modalProductName.textContent = product.name;
      // –ø–æ–¥–º–µ–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª–∫–∏ –Ω–∞ –∞–Ω–∏–º. –µ–º–æ–¥–∑—ñ
      modalEmojiVideo.src = '';
      modalEmojiVideo.pause();
      modalEmojiVideo.currentTime = 0;
      const media = await getAnimatedEmojiMedia(product.emoji);
      if (media && media.webm) {
        modalEmojiVideo.src = media.webm;
        modalEmojiVideo.autoplay = true;
        modalEmojiVideo.loop = false;
        modalEmojiVideo.muted = true;
        modalEmojiVideo.playsInline = true;
        modalEmojiVideo.onended = null;
      } else {
        // –µ—Å–ª–∏ –Ω–µ—Ç webm ‚Äî –ø–æ–∫–∞–∂–µ–º —Å—Ç–∞—Ç–∏–∫ —á–µ—Ä–µ–∑ data-uri —ç–º–æ–¥–∑–∏
        const pngFallback = `data:image/svg+xml;charset=UTF-8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="96">'+product.emoji+'</text></svg>')}`;
        modalEmojiVideo.poster = pngFallback;
      }
      starModal.classList.add('visible');
      confirmStarPaymentBtn.dataset.productId = productId;
    }

    function closeStarModal() {
      starModal.classList.remove('visible');
      modalEmojiVideo.pause();
    }

    function handleStarPayment() {
      const invoiceLink = `https://t.me/invoice/example`;
      tg.openInvoice(invoiceLink, (status) => {
        if (status === 'paid') tg.close();
      });
      closeStarModal();
    }

    /*** =======================
     *  –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
     * ======================== */
    document.addEventListener('DOMContentLoaded', () => {
      tg.ready();

      tg.MainButton.textColor = '#FFFFFF';
      tg.MainButton.color = '#27ae60';
      tg.MainButton.onClick(() => {
        if (currentPage === 'catalog-page') {
          showPage('order-page');
        } else if (currentPage === 'order-page') {
          const total = calculateTotal();
          tg.showAlert(`Final amount to pay: $${total.price.toFixed(2)}`);
          // –¢—É—Ç –±—É–¥–µ –ª–æ–≥—ñ–∫–∞ —Ä–µ–∞–ª—å–Ω–æ—ó –æ–ø–ª–∞—Ç–∏
        }
      });

      tg.BackButton.onClick(() => showPage('catalog-page'));
      confirmStarPaymentBtn.addEventListener('click', handleStarPayment);

      renderSkeleton();
      setTimeout(async () => {
        catalogGrid.style.display = 'flex';
        skeletonLoader.style.display = 'none';
        await renderCatalog();
      }, 500);
    });

    // –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è onclick –≤ HTML
    window.addToCart = addToCart;
    window.removeFromCart = removeFromCart;
    window.buyWithStars = buyWithStars;
    window.closeStarModal = closeStarModal;
  </script>

  <!--
    ================================
    === BACKEND –ü–†–û–ö–°–ò (–ø—Ä–∏–º–µ—Ä) ===
    ================================
    1) –≠—Ç–æ—Ç —Ñ—Ä–æ–Ω—Ç –æ–∂–∏–¥–∞–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç:
       GET /api/animated-emoji?emoji=üçî
       -> { ok: true, emoji: "üçî", webm: "https://api.telegram.org/file/bot<token>/<path>.webm", webp: "https://.../file.webp", width: 512, height: 512 }

    2) –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∞–Ω–∏–º. —ç–º–æ–¥–∑–∏ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ:
       - –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± (MTProto):
         messages.getStickerSet(inputStickerSetAnimatedEmoji)
         –î–∞–ª–µ–µ –Ω–∞–π–¥–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç, –≥–¥–µ –∞—Ç—Ä–∏–±—É—Ç alt == –Ω—É–∂–Ω—ã–π emoji, —Å–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª (webm).

       - –ß–µ—Ä–µ–∑ Bot API (–ø—Ä–æ—â–µ):
         a) –í—ã–∑–≤–∞—Ç—å getStickerSet —Å –∏–º–µ–Ω–µ–º –Ω–∞–±–æ—Ä–∞ –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–º–æ–¥–∑–∏ (–∞–Ω–∞–ª–æ–≥ –Ω–∞–±–æ—Ä–∞ Animated Emoji).
         b) –í –æ—Ç–¥–∞–Ω–Ω—ã—Ö —Å—Ç–∏–∫–µ—Ä–∞—Ö –Ω–∞–π—Ç–∏ —Ç–æ—Ç, —É –∫–æ—Ç–æ—Ä–æ–≥–æ .emoji == –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π emoji –∏ —ç—Ç–æ video sticker / –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π.
         c) –í—ã–∑–≤–∞—Ç—å getFile(file_id) –∏ –≤–µ—Ä–Ω—É—Ç—å –∫–ª–∏–µ–Ω—Ç—É —Å—Å—ã–ª–∫—É:
            https://api.telegram.org/file/bot<YOUR_BOT_TOKEN>/<file_path>

    3) –ü—Ä–∏–º–µ—Ä Node/Express (–ø—Å–µ–≤–¥–æ–∫–æ–¥):
      const express = require('express');
      const fetch = require('node-fetch');
      const app = express();
      const BOT_TOKEN = process.env.BOT_TOKEN;
      const SET_NAME = process.env.ANIMATED_EMOJI_SET || 'AnimatedEmoji'; // –∏–º—è –Ω–∞–±–æ—Ä–∞; –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ

      app.get('/api/animated-emoji', async (req, res) => {
        try {
          const emoji = req.query.emoji;
          if (!emoji) return res.json({ ok:false });

          // 1) –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Ç
          const setResp = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getStickerSet?name=${encodeURIComponent(SET_NAME)}`);
          const setJson = await setResp.json();
          if (!setJson.ok) return res.json({ ok:false });

          // 2) –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π —Å—Ç–∏–∫–µ—Ä –ø–æ emoji
          const sticker = (setJson.result.stickers || []).find(s => s.emoji === emoji);
          if (!sticker) return res.json({ ok:false });

          // 3) –ø–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª
          const fileResp = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getFile?file_id=${sticker.file_id}`);
          const fileJson = await fileResp.json();
          if (!fileJson.ok) return res.json({ ok:false });

          const filePath = fileJson.result.file_path;
          const fileUrl = `https://api.telegram.org/file/bot${BOT_TOKEN}/${filePath}`;

          // –ü—Ä–æ—Å—Ç–µ–π—à–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
          const isWebm = filePath.endsWith('.webm') || sticker.is_video;
          const payload = { ok:true, emoji, width:512, height:512 };
          if (isWebm) payload.webm = fileUrl; else payload.webp = fileUrl;
          res.json(payload);
        } catch (e) {
          res.json({ ok:false });
        }
      });

      // –í–∞–∂–Ω–æ: –Ω–µ –æ—Ç–¥–∞–≤–∞–π—Ç–µ BOT_TOKEN –∫–ª–∏–µ–Ω—Ç—É!
  -->
</body>
</html>
